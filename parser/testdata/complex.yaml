services:
  - name: api-gateway
    endpoints:
      - method: GET
        path: /api/orders
        idempotent: true
      - method: POST
        path: /api/orders
        idempotent: false
    dependencies:
      - target: order-svc
        timeout: 5s
        max_retries: 3
        backoff_base: 200ms
        backoff_jitter_enabled: true
        circuit_breaker_enabled: true
      - target: auth-svc
        timeout: 2s
        max_retries: 1
        backoff_base: 100ms
        backoff_jitter_enabled: true
        circuit_breaker_enabled: true

  - name: order-svc
    endpoints:
      - method: GET
        path: /orders
        idempotent: true
    dependencies:
      - target: inventory-svc
        timeout: 3s
        max_retries: 2
        backoff_base: 150ms
        backoff_jitter_enabled: true
        circuit_breaker_enabled: true
      - target: payment-svc
        timeout: 10s
        max_retries: 0
        backoff_base: 0s
        backoff_jitter_enabled: false
        circuit_breaker_enabled: true

  - name: auth-svc
    endpoints:
      - method: POST
        path: /auth/validate
        idempotent: true
    dependencies: []

  - name: inventory-svc
    endpoints:
      - method: GET
        path: /stock
        idempotent: true
    dependencies:
      - target: db-svc
        timeout: 1s
        max_retries: 1
        backoff_base: 50ms
        backoff_jitter_enabled: false
        circuit_breaker_enabled: false

  - name: payment-svc
    endpoints:
      - method: POST
        path: /charge
        idempotent: false
    dependencies:
      - target: stripe-gateway
        timeout: 15s
        max_retries: 2
        backoff_base: 500ms
        backoff_jitter_enabled: true
        circuit_breaker_enabled: true

  - name: db-svc
    endpoints:
      - method: GET
        path: /query
        idempotent: true
    dependencies: []

  - name: stripe-gateway
    endpoints:
      - method: POST
        path: /v1/charges
        idempotent: false
    dependencies: []
